---
output: html_document
---


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, warning = FALSE, message = FALSE)

library(esquisse)
library(ggplot2)
library(ModEstM)
library(tidyr)




```

```{r}
#Hiper parametros 
votantes = c(130832, 229927, 347262, 426871)

total = 900 * 750

simulaciones = 10000
```

```{r echo=TRUE}
sim_teoria_Elecciones <- function(a,b, muestra, total){
  # a, parametro 1 de nuestra distribucuon beta
  # b, parametro 2 de nuestra beta
  # muestra, qwuiero saber la muestra que tengo
  a_post <- a + muestra
  b_post <- b +  total - muestra
  
  #Crenado una secuencia para
  theta <- seq(0.01, 0.99, length.out = 100)
  prior <-  dbeta(theta, a, b)
  log_verosimilitud <- muestra * log(theta) + (total - muestra) + log(1 - theta)
  exp_verosimilitud <- dbinom(muestra, size = total, prob = theta)
  #exp(log_verosimilitud - max(log_verosimilitud))
  posterior <- dbeta(theta, a_post, b_post)
  
  df <- data.frame(
    theta = theta,
    prior = prior, 
    exp_verosimilitud = exp_verosimilitud,
    posterior = posterior
  )
  
  df_long <- pivot_longer(df,
                          cols = c(prior, exp_verosimilitud, posterior),
                          names_to = "Distribucion",
                          values_to = "Densidad")
  return(df_long)
}

medidas_Eleccciones <- function(a,b, muestra, total){
   a_post <- a + muestra
   b_post <- b +  total - muestra
  #Estimaciones Teoricas
  media <- a_post / (a_post + b_post)
  intervalo <- qbeta(c(0.025, 0.975), a_post, b_post)
  #Estimaciones Simuladas
  x = rbeta(simulaciones, a_post,b_post)
  media_S = mean(x) #Media simulada
  Intervalo_S = quantile(x, c(0.025, 0.975)) #Intervalo simulado
  
  salida <- list(
    Media = media,
    Intervalo = intervalo,
    Media_Sim = media_S,
    Intervalo_Sim = Intervalo_S
  )
  return(salida)
}
```
# Inciso a) 


```{r}
for(i in 1:4){
  df_plot <- sim_teoria_Elecciones(30, 20, votantes[i], total * i* (0.25))
  
 print(
    ggplot(df_plot, aes(x = theta, y = Densidad, color = Distribucion)) +
    geom_line(size = 1) +
    theme_minimal() +
    labs(title =  "Distribuciones: prior, verosimilitud y posterior",
         subtitle  = paste( " con num. votantes = ", votantes[i], " y num total de votantes = ", total * i* 0.25),
         x = expression(theta),
         y = "Densidad") + 
      annotate("text",
               x = 0.005,
               y = max(df_plot$Densidad) * 0.9,
               hjust = 0,
               size = 4,
               label = paste0(
                              " -Con una media de: ", round( medidas_Eleccciones(30, 20, votantes[i], total * i* (0.25))$Media, 5), 
                              " y un intervalo \nde: (", round(medidas_Eleccciones(30, 20, votantes[i], total * i* (0.25))$Intervalo[1],5), ","
                              , round(medidas_Eleccciones(30, 20, votantes[i], total * i* (0.25))$Intervalo[2], 5) , ")", "(Forma Teorica)",
                              "\n -Con una media de: ", round(medidas_Eleccciones(30, 20, votantes[i], total * i* (0.25))$Media_Sim, 5),
                              " y un intervalo \nde: (", round(medidas_Eleccciones(30, 20, votantes[i], total * i* (0.25))$Intervalo_Sim[1],5), ","
                              , round(medidas_Eleccciones(30, 20, votantes[i], total * i* (0.25))$Intervalo_Sim[2], 5) , ")", "(Forma Simulada)"
                              )  
                              )
      
 )
  
}
```

# Inciso b) 

Sea la distribucion Uniforme(0,1), equivalente a la Beta(1,1)


```{r}
for(i in 1:4){
  df_plot <- sim_teoria_Elecciones(1, 1, votantes[i], total * i * 0.25)
  
  print(
    ggplot(df_plot, aes(x = theta, y = Densidad, color = Distribucion)) +
      geom_line(size = 1) +
      theme_minimal() +
      labs(
        title =  "Distribuciones: prior, verosimilitud y posterior",
        subtitle = paste("con num. votantes =", votantes[i], 
                         "y num total de votantes =", total * i * 0.25),
        x = expression(theta),
        y = "Densidad"
      ) + 
      annotate("text",
        x = 0.005,
        y = max(df_plot$Densidad) * 0.9,
        hjust = 0,
        size = 4,
        label = paste0(
          " -Con una media de: ", round(medidas_Eleccciones(1, 1, votantes[i], total * i * 0.25)$Media, 5), 
          " y un intervalo \nde: (", round(medidas_Eleccciones(1, 1, votantes[i], total * i * 0.25)$Intervalo[1], 5), ",",
                                   round(medidas_Eleccciones(1, 1, votantes[i], total * i * 0.25)$Intervalo[2], 5), ")", " (Forma TeÃ³rica)",
          "\n -Con una media de: ", round(medidas_Eleccciones(1, 1, votantes[i], total * i * 0.25)$Media_Sim, 5),
          " y un intervalo \nde: (", round(medidas_Eleccciones(1, 1, votantes[i], total * i * 0.25)$Intervalo_Sim[1], 5), ",",
                                     round(medidas_Eleccciones(1, 1, votantes[i], total * i * 0.25)$Intervalo_Sim[2], 5), ")", " (Forma Simulada)"
        )
      )
  )
}

      
```

# Concluir 

Lorem ipsum dolor sit amet, consectetur adipiscing elit
Lorem ipsum dolor sit amet, consectetur adipiscing elit
Lorem ipsum dolor sit amet, consectetur adipiscing elit
Lorem ipsum dolor sit amet, consectetur adipiscing elit
Lorem ipsum dolor sit amet, consectetur adipiscing elit
Lorem ipsum dolor sit amet, consectetur adipiscing elit